<div style="height: 70vh" class="row">
  <div class="grid flex">
    <div class="col-12 lg:col-3 h-full">
      <h4 class="text-center">Vulnerability Reports Statistics</h4>
      <div class="flex row">
        <p-table ngClass="w-full" styleClass="p-datatable-sm text-sm" [value]="severitiesSummaryForTable">
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 50%; max-width: 50%">Severity</th>
              <th style="width: 25%; max-width: 25%" class="text-right">Count</th>
              <th style="width: 25%; max-width: 25%" class="text-right">Fixable</th>
            </tr>
          </ng-template>
          <ng-template let-severity pTemplate="body">
            <tr>
              <td style="width: 50%; max-width: 50%">{{ severity.severityName }}</td>
              <td style="width: 25%; max-width: 25%" class="text-right">{{ severity.count }}</td>
              <td style="width: 25%; max-width: 25%" class="text-right">{{ severity.fixable }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <div class="flex row mb-5 text-sm justify-content-end -ml-1">
        <p-button label="More on Severities..." size="small" [text]="true" (onClick)="onVrsMore($event)" />
      </div>
      <h5 class="text-center">Various Statistics</h5>
      <div class="flex row mb-5">
        <p-table styleClass="p-datatable-sm text-sm" class="w-full" [value]="othersSummaryForTable">
          <ng-template let-others pTemplate="body">
            <tr>
              <td style="width: 50%; max-width: 50%">{{ others.description }}</td>
              <td style="width: 25%; max-width: 25%" class="text-right">{{ others.count }}</td>
              <td style="width: 25%; max-width: 25%">
                <div class="flex justify-content-end">
                  <p-button
                    label="More..."
                    size="small"
                    styleClass="text-sm p-0"
                    [text]="true"
                    (onClick)="onOthersMore(others)"
                  />
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <div class="hide-on-small lg:col-9 h-full justify-content-center">
      <p-carousel [autoplayInterval]="10000" [numScroll]="1" [numVisible]="1" [value]="slides">
        <ng-template let-slide pTemplate="item">
          <div class="custom-slide">
            <ng-container [ngSwitch]="slide">
              <div *ngSwitchCase="'vrByNs'">
                <h4 style="text-align: center">Vulnerabilities by Namespace</h4>
                <div *ngIf="horizontalBarChartDataByNs" class="flex justify-content-center">
                  <p-chart
                    height="60vh"
                    type="bar"
                    width="60vw"
                    class="justify-content-center"
                    [data]="horizontalBarChartDataByNs"
                    [options]="horizontalBarChartOption"
                  />
                </div>
              </div>
              <div *ngSwitchCase="'vrBySev'">
                <h4 style="text-align: center">Vulnerabilities by Severity</h4>
                <div *ngIf="horizontalBarChartDataByNs" class="flex justify-content-center">
                  <p-chart
                    height="60vh"
                    type="bar"
                    width="60vw"
                    [data]="horizontalBarChartDataBySeverity"
                    [options]="horizontalBarChartOption"
                  />
                </div>
              </div>
            </ng-container>
          </div>
        </ng-template>
      </p-carousel>
    </div>
  </div>
</div>

<p-dialog
  closable="true"
  closeOnEscape="true"
  dismissableMask="true"
  header="{{ moreOthersModalTitle }}"
  resizable="true"
  [breakpoints]="{ '1490px': '90vw' }"
  [contentStyle]="{ height: '60vh' }"
  [modal]="true"
  [style]="{ width: '1340px' }"
  [(visible)]="isMoreOthersModalVisible"
>
  <div class="row grid">
    <div style="height: 55vh" class="col-12 sm:col-4">
      <p-table
        scrollHeight="flex"
        sortMode="multiple"
        styleClass="p-datatable-sm text-sm"
        [scrollable]="true"
        [value]="genericByNsSummaryDtos"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="namespaceName" style="width: 50%; max-width: 50%">
              Namespace
              <p-sortIcon field="namespaceName" />
            </th>
            <th pSortableColumn="totalCount" style="width: 25%; max-width: 25%" class="text-right">
              Total
              <p-sortIcon field="totalCount" />
            </th>
            <th pSortableColumn="distinctCount" style="width: 25%; max-width: 25%" class="text-right">
              Distinct
              <p-sortIcon field="distinctCount" />
            </th>
          </tr>
        </ng-template>
        <ng-template let-others pTemplate="body">
          <tr *ngIf="!others.isTotal">
            <td style="width: 50%; max-width: 50%">{{ others.namespaceName }}</td>
            <td style="width: 25%; max-width: 25%" class="text-right">{{ others.totalCount }}</td>
            <td style="width: 25%; max-width: 25%" class="text-right">{{ others.distinctCount }}</td>
          </tr>
        </ng-template>
        <ng-template let-othersx pTemplate="footer">
          <tr>
            <td></td>
            <td class="text-right">{{ getFooterData('totalCount') }}</td>
            <td class="text-right">{{ getFooterData('distinctCount') }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <div style="height: 55vh" class="col-12 sm:col-8">
      <p-table
        scrollHeight="flex"
        sortMode="multiple"
        styleClass="p-datatable-sm text-sm"
        [scrollable]="true"
        [value]="genericSummaryDtos"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="name" style="width: 70%; max-width: 70%">
              Name
              <p-sortIcon field="name" />
            </th>
            <th pSortableColumn="count" style="width: 30%; min-width: 20%" class="text-right">
              Count
              <p-sortIcon field="count" />
            </th>
          </tr>
        </ng-template>
        <ng-template let-others pTemplate="body">
          <tr>
            <td style="width: 70%; max-width: 70%">{{ others.name }}</td>
            <td style="width: 30%; max-width: 30%" class="text-right">{{ others.count }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</p-dialog>

<p-dialog
  closable="true"
  closeOnEscape="true"
  dismissableMask="true"
  header="Vulnerability Reports Details"
  resizable="true"
  [contentStyle]="{ height: '70vh' }"
  [modal]="true"
  [style]="{ width: '90vw' }"
  [(visible)]="isMoreVRDetailsModalVisible"
>
  <div *ngIf="vulnerabilityReportSumaryDto?.severitiesByNsSummaryDtos" style="height: 65vh">
    <p-table
      scrollDirection="both"
      styleClass="p-datatable-sm text-sm"
      [scrollable]="true"
      [value]="vulnerabilityReportSumaryDto!.severitiesByNsSummaryDtos!.sort(sortOthersByNsSummary)"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pFrozenColumn rowspan="2">Namespace</th>
          <ng-container *ngFor="let id of severityWrapperGetSeverityIds()">
            <th colspan="2" class="text-center">{{ severityWrapperGetCapitalizedName(id) }}</th>
          </ng-container>
        </tr>
        <tr>
          <ng-container *ngFor="let id of severityWrapperGetSeverityIds()">
            <th class="text-center">Count</th>
            <th class="text-center">Fixable</th>
          </ng-container>
        </tr>
      </ng-template>
      <ng-template let-severitiesByNsSummary pTemplate="body">
        <tr [ngStyle]="getRowStyle(severitiesByNsSummary)">
          <td pFrozenColumn>{{ severitiesByNsSummary.isTotal ? 'Total' : severitiesByNsSummary.namespaceName }}</td>
          <ng-container *ngFor="let id of severityWrapperGetSeverityIds()">
            <td class="text-center">
              <ng-container *ngIf="getSeveritiesDistinctCount(severitiesByNsSummary.details, id).toString() as result">
                <p-tag
                  *ngIf="result !== '0'"
                  [rounded]="true"
                  [style]="{ background: severityWrapperGetgetCssColor(id) }"
                  [value]="result"
                />
              </ng-container>
            </td>
            <td class="text-center">
              <ng-container *ngIf="getSeveritiesFixableCount(severitiesByNsSummary.details, id).toString() as result">
                <p-tag
                  *ngIf="result !== '0'"
                  [rounded]="true"
                  [style]="{ background: severityWrapperGetgetCssColor(id) }"
                  [value]="result"
                />
              </ng-container>
            </td>
          </ng-container>
        </tr>
      </ng-template>
    </p-table>
  </div>
</p-dialog>
